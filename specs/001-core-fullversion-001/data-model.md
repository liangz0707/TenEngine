# Data Model: 001-Core 完整功能集

**Branch**: `001-core-fullversion-001` | **Phase**: 1  
**Purpose**: 本 feature 涉及的实体、句柄与约束，与契约「类型与句柄」对齐。

## 1. 内存 (Memory)

| 实体/句柄 | 类型/语义 | 生命周期 |
|-----------|-----------|----------|
| 分配器 | Allocator 接口（Alloc/Free） | 由调用方或全局单例持有 |
| 内存块句柄 | void*（由 Alloc 返回） | 分配后直至显式 Free |
| 池 | PoolAllocator 管理块池 | 与分配器一致 |
| 调试/泄漏 | DebugAllocator/LeakTracker 包装 | 与分配器一致 |

约束：Alloc(0/非法 alignment)→nullptr；Free(nullptr)/double-free 为 no-op；池与调试为可选。

---

## 2. 线程 (Thread)

| 实体/句柄 | 类型/语义 | 生命周期 |
|-----------|-----------|----------|
| Thread | 线程句柄/对象 | 创建后至 join/detach 或进程结束 |
| TLS | 线程局部槽 | 线程生命周期 |
| Atomic&lt;T&gt; | 原子类型 | 由调用方管理 |
| Mutex / ConditionVariable | 同步原语 | 由调用方管理 |
| TaskQueue | 任务队列骨架 | 由调用方管理；任务提交至完成或取消 |

---

## 3. 平台 (Platform)

| 实体/句柄 | 类型/语义 | 生命周期 |
|-----------|-----------|----------|
| 文件句柄 | 文件读写抽象 | 打开后直至关闭 |
| 目录迭代器 | 目录枚举 | 枚举期间 |
| 时间/计时器 | 时间与高精度计时 | 按 API 约定 |
| 路径/环境 | 路径规范化、环境变量 | 值类型或只读引用 |

---

## 4. 日志 (Log)

| 实体/句柄 | 类型/语义 | 生命周期 |
|-----------|-----------|----------|
| LogLevel | 枚举 Debug/Info/Warn/Error | 值类型 |
| LogSink | 输出通道抽象 | 由调用方或全局配置 |
| 消息 | 单条日志内容 | 写入时原子输出 |

---

## 5. 数学 (Math)

| 实体 | 类型/语义 | 生命周期 |
|------|-----------|----------|
| Vector2/3/4, Matrix3/4, Quaternion, AABB, Ray | 值类型 | 由调用方管理 |
| Lerp 等 | 自由函数 | N/A |

---

## 6. 容器 (Containers)

| 实体 | 类型/语义 | 生命周期 |
|------|-----------|----------|
| Array, Map, String | 动态容器；可指定分配器 | 由调用方管理 |
| UniquePtr, SharedPtr | 智能指针 | 由调用方管理 |

约束：无反射、无 ECS；可与自定义分配器配合。

---

## 7. 模块加载 (ModuleLoad)

| 实体/句柄 | 类型/语义 | 生命周期 |
|-----------|-----------|----------|
| 模块句柄 | LoadLibrary 返回 | Load 后直至 Unload |
| 符号地址 | GetSymbol 返回 | 模块加载期内有效 |
| Init/Shutdown 回调 | 注册与调用顺序 | 按契约约定 |

---

## 与契约的对应

- 契约「类型与句柄」表与上一致；生命周期与语义以契约与规约为准。
- 能力列表 1～7 与上述 7 个子模块一一对应；实现仅暴露契约已声明的类型与 API。
