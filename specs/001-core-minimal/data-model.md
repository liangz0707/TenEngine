# Data Model: 001-Core 最小切片（Alloc/Free、Log）

**Branch**: `001-core-minimal` | **Phase**: 1  
**Purpose**: 本切片涉及的实体、属性与约束，供实现与契约对齐。

## 1. 内存（Alloc/Free）

### 1.1 内存块句柄

| 属性 | 类型 | 说明 |
|------|------|------|
| 句柄 | `void*` | 由 `Alloc(size, alignment)` 返回；指向对齐后的内存块，大小至少 `size` 字节。 |
| 生命周期 | 从 Alloc 返回到对应 Free(ptr) 调用 | 调用方不得在 Free 后使用该指针；double-free 与 Free(nullptr) 为 no-op。 |

**约束**:
- `size == 0` 或 `alignment` 不合法（如非 2 的幂、过大）时，Alloc 返回 `nullptr`。
- 同一指针至多 Free 一次（第二次及以后为 no-op）；Free 仅接受本模块 Alloc 返回的指针或 `nullptr`。

### 1.2 无额外实体

本切片不引入 Allocator 类型、池、或统计结构；仅 Alloc/Free 两个函数。

---

## 2. 日志（Log）

### 2.1 LogLevel

| 值 | 含义 |
|----|------|
| Debug | 调试信息 |
| Info | 一般信息 |
| Warn | 警告 |
| Error | 错误 |

至少支持以上四级；顺序为 Debug < Info < Warn < Error（用于过滤与通道映射）。

### 2.2 Log 配置（逻辑）

| 概念 | 说明 |
|------|------|
| 级别过滤阈值 | 低于该级别的消息不输出（可配置）。 |
| stderr 阈值 | 级别 ≥ 该阈值的消息输出到 stderr，其余输出到 stdout（可配置）。 |

具体存储与 API（全局/线程局部、结构体名）由实现与契约「API 雏形」定稿；本切片保证可配置「某级别及以上→stderr、其余→stdout」及过滤。

### 2.3 消息

单条消息：由调用方传入的 `char const* message`；写入时原子输出（不与其他线程的消息交错）。

---

## 3. 关系与状态

- **内存**：无跨调用状态（除进程堆）；Alloc/Free 无状态类型。
- **Log**：具备配置状态（级别阈值、stderr 阈值）；写入为线程安全，内部可有静态/线程局部缓冲，但不暴露给调用方。

---

## 4. 与契约的对应

- 类型与句柄：契约「分配器/内存块句柄」→ 本切片为 `void*`；契约「日志级别、通道」→ 本切片为 LogLevel 枚举与 stdout/stderr。
- 能力列表：本切片实现契约「内存管理」中的分配/释放子集与「日志」中的分级、输出通道、可过滤子集；不实现断言、崩溃钩子、池化、泄漏追踪。
