# 契约：Core 模块对外 API

## 适用模块

- **实现方**：`specs/001-engine-core-module`（游戏引擎 Core 模块）
- **交付形态**：动态链接库，主工程在运行时加载、调用与卸载。

## 消费者

- 002-rendering-rci-interface（平台抽象、窗口/上下文、可选内存）
- 003-editor-system（平台、线程、可选 ECS/序列化）
- 004-resource-system（平台抽象、文件 I/O、内存、线程）
- 005-shader-system（平台抽象、文件 I/O）

## 版本 / ABI

- 遵循 Constitution：公开 API 版本化（MAJOR.MINOR.PATCH），破坏性变更递增 MAJOR 并附迁移说明。
- 当前契约版本：（由实现或计划阶段填写）

## 类型与句柄（跨边界）

| 名称 | 语义 | 生命周期 |
|------|------|----------|
| 实体 (Entity) | ECS 中可标识对象，可挂载多个组件 | 创建后直至显式销毁 |
| 组件 (Component) | 附着于实体的类型化数据单元 | 随实体或显式移除 |
| 系统 (System) | 对实体/组件迭代处理的逻辑单元 | 注册后按帧/按需执行 |
| 内存块 / 分配句柄 | 由内存管理分配的逻辑单元 | 分配后直至显式释放 |
| 任务 / 作业 (Task/Job) | 提交给线程管理的可执行单元 | 提交后至完成或取消 |
| 平台句柄 | 对文件、路径、时间等的抽象引用 | 按具体子 API 约定 |
| 序列化载荷 | 序列化输出的字节流或持久化结构 | 由调用方管理缓冲生命周期 |

## 能力列表（提供方保证）

1. **加载/卸载**：主工程可加载 Core 动态库、调用初始化接口、卸载；行为可观测、无崩溃/泄漏。
2. **内存管理**：分配（指定大小与对齐）、释放、可选统计；分配失败与释放语义明确（如 nullptr、重复释放有定义）。
3. **线程管理**：创建/销毁 workers、提交任务、等待完成、简单同步原语；任务执行与同步语义明确。
4. **ECS**：创建/销毁实体、添加/移除组件、注册系统、单帧或 Tick 执行；数据布局与迭代规则可验证。
5. **平台抽象**：文件读/写、路径解析、时间戳、环境信息；与具体 OS 解耦、行为可重复验证。
6. **序列化**：将指定结构序列化为字节流或持久化格式，并支持反序列化还原；往返等价性可验证，版本与兼容策略有定义。

## 调用顺序与约束

- 主工程必须先加载 Core 动态库并调用**指定初始化接口**，再调用各子系统接口；卸载前应释放所有由 Core 分配的资源并停止使用句柄。
- 具体初始化/卸载顺序与 ABI 由实现与主工程约定，并由功能测试模块验证。

## 变更记录

| 日期 | 变更说明 |
|------|----------|
| （初始） | 从 001-engine-core-module spec 提炼，供多 Agent 引用 |
