# 契约：RCI 渲染抽象层对外 API

## 适用模块

- **实现方**：`specs/002-rendering-rci-interface`（Rendering 模块 - RCI 接口抽象层）
- **角色**：向上层提供统一渲染接口，向下对接多种图形 API（DLL 或源码集成）。

## 消费者

- 003-editor-system（渲染窗口）
- 005-shader-system（提交编译后的 shader 程序给渲染管线）
- 006-render-pipeline-system（接收抽象命令缓冲并执行）

## 版本 / ABI

- 遵循 Constitution：公开 API 版本化；破坏性变更递增 MAJOR。
- 当前契约版本：（由实现或计划阶段填写）

## 类型与句柄（跨边界）

| 名称 | 语义 | 生命周期 |
|------|------|----------|
| 渲染资源 (Render Resource) | 纹理、缓冲区、着色器程序等；有类型、大小、格式 | 创建后直至显式销毁 |
| 渲染命令 (Render Command) | 单次绘制、状态设置、资源绑定等 | 通常由命令缓冲持有 |
| 图形 API 适配器 (Adapter) | 特定图形 API 的底层实现 | 由 RCI 系统加载与管理 |
| 渲染状态 (Render State) | 混合、深度、视口等管线配置 | 由 RCI 管理，可查询 |

## 能力列表（提供方保证）

1. **统一渲染命令接口**：抽象底层图形 API 差异；上层可提交绘制、计算、状态设置等。
2. **资源管理**：创建、更新、销毁渲染资源；返回有效句柄，失败时有明确报告。
3. **渲染状态配置**：混合模式、深度测试、裁剪等；可查询当前状态。
4. **命令提交与执行**：绘制调用、计算着色器调用等；命令被正确记录并执行，结果呈现到目标（窗口或离屏缓冲）。
5. **多适配器**：支持多种图形 API 适配器（至少 DLL 与源码两种集成方式）；可枚举、选择、切换适配器。
6. **错误与恢复**：适配器初始化失败或运行时错误可上报；支持回退到备用适配器，不导致引擎崩溃。
7. **线程安全**：RCI 接口在多线程访问下的行为明确（由实现定义并文档化）。

## 调用顺序与约束

- 上层必须先完成 RCI 初始化（及所需窗口/上下文，可能依赖 Core 平台抽象），再创建资源与提交命令。
- 资源销毁顺序不得违反底层 API 要求（如先释放依赖该资源的命令或管线状态）。

## 与流水线的边界

- 渲染流水线（006）产出的**抽象命令缓冲**通过本契约约定的接口提交给 RCI；具体数据结构与提交时机见契约 `pipeline-to-rci.md`。

## 变更记录

| 日期 | 变更说明 |
|------|----------|
| （初始） | 从 002-rendering-rci-interface spec 提炼，供多 Agent 引用 |
