---
description: 多 Agent 协作时跨模块接口同步：契约以 T0-contracts 为准；工作前拉契约、实现前读契约。写回契约与修改本模块 API/ABI 的流程及下游 TODO 见命令 engine.contracts-downstream-todo 及 docs/agent-workflow-complete-guide.md。
globs: specs/**/*.md, docs/**/*.md, **/spec.md
---

# 接口同步（多 Agent 协作）

契约以 **T0-contracts** 为准；跨模块接口的单一事实来源即该分支上的 `specs/_contracts/`；各模块 spec 只**引用**契约，不重复定义跨边界类型或调用约定。拉取/推送契约见命令 **engine.contracts-pull**、**engine.contracts-push** 及 speckit.specify 第一步。

## 实现或改 spec 前

- 确认已拉取最新契约（可用命令 engine.contracts-pull）。
- 打开本模块的 `docs/module-specs/NNN-modulename.md` 或 `spec.md`，查看 **Dependencies** 与 **Interface Contracts**；对每个依赖的上游，阅读 `specs/_contracts/` 下对应 **public-api** 与 **ABI**，实现时只使用契约中已声明的类型与接口（功能与语义以 API 为准，具体接口形式以 ABI 为准；见 `.cursor/rules/contracts-api-abi.mdc`）。

## 依赖与接口

- **依赖总览**：`specs/_contracts/000-module-dependency-map.md`。新增/修改依赖时同步更新该文件与各 spec 的 Dependencies。
- **接口如何确定**：契约（能力与类型）+ ABI（命名空间、头文件、符号）→ 真实 API；实现与下游以 ABI 为准；真实 API 变更时需同步更新契约与 ABI。发现依赖接口变化时先拉取契约再适配（engine.contracts-pull）。详见 `docs/agent-interface-sync.md`。

## 构建规约（Agent 必须遵守）

- 按 `docs/engine-build-module-convention.md` 执行（构建方式澄清见该文档 **§3**；该文档无 §1.1）。plan 产出**必须**澄清「依赖引入方式」：各直接依赖均按**源码**方式引入；禁止手写 add_subdirectory/find_package 分支、禁止对测试/可执行显式 link 上游。任何编译、测试的 build 必须按该规约构建依赖与目标。
- **用户说「要构建工程」时**：若根目录或依赖路径（TENENGINE_ROOT 等）不清楚，**必须**先问用户，不得擅自假设；各子模块均使用源码方式。明确后再执行 cmake 配置与构建。
