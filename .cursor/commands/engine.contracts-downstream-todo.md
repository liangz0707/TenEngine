---
description: plan 结束后由用户主动调用：在本模块 API/ABI 增加 ## 变更记录 后，在依赖本模块的各下游 public-api 中增加 TODO 兼容记录
---

## 用途

当在本模块的 **public-api** 或 **ABI** 中增加了 **## 变更记录** 后（例如 plan 写回契约后），由**用户主动运行**本命令，在**依赖本模块的所有下游模块**的 public-api 中增加 **TODO 兼容记录**，便于下游后续适配。

**调用时机**：本命令在 **plan 结束、写回契约完成后** 由用户主动调用，不做自动触发。

## 输入（可选）

- **上游模块**：模块编号或名称（如 `013`、`013-Resource`）。若未提供，从当前打开或最近编辑的 `specs/_contracts/` 下文件推断（如 `013-resource-public-api.md` → 013）。
- **变更要点**：一句话或列表，概括本次变更。若未提供，从本模块契约中的 **## 变更记录** 小节摘录或概括。

## 执行步骤

1. **确定上游模块**  
   使用用户传入的模块编号/名称，或从当前编辑的契约文件路径推断（`specs/_contracts/NNN-modulename-*.md` → 模块 NNN）。

2. **查下游列表**  
   打开 `specs/_contracts/000-module-dependency-map.md`，在 **「谁被谁依赖（上游 → 下游）」** 表中找到该上游模块对应的**依赖它的下游**模块编号列表。

3. **为每个下游增加 TODO 兼容记录**  
   对表中列出的每个下游模块：
   - 打开 `specs/_contracts/NNN-modulename-public-api.md`（NNN 为下游模块编号）。
   - 在合适位置增加 **TODO 兼容记录**：
     - 若无 **「## TODO 兼容」** 或 **「## 兼容性」** 等小节，可在文末或约定位置新增该小节。
     - 新增一条记录，格式示例：
       ```markdown
       - **TODO [上游 013-Resource]**：<变更要点简述>（需跟进适配）
       ```
   - 若该下游 public-api 中已有针对同一上游的 TODO 条，可合并为一条或按时间追加，避免重复。

4. **收尾**  
   保存所有修改过的下游 public-api 文件，并简要列出已写入 TODO 的下游模块与文件路径。

## 说明

- 本命令只修改 **下游** 的 **public-api** 文件，不修改 ABI 或本模块契约。
- 变更要点应简洁，便于下游据此判断是否需要改代码或契约。
